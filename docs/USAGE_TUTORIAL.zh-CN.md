# AstrBot Live2D Desktop 使用教程

本文档面向桌面端用户，介绍从连接到日常使用的完整流程。

## 1. 开始前准备

请先确认：

- 已安装并启用 AstrBot 的 `astrbot-live2d-adapter` 适配器。
- 已拿到适配器使用的认证密钥（`auth_token`）。
- 桌面端和 AstrBot 服务端网络可达（本机或局域网/公网）。

> 如果适配器没有手动配置 `auth_token`，会自动生成并保存到：
> `AstrBot/data/plugin_data/astrbot-live2d-adapter/live2d_auth_token.txt`

## 2. 首次连接（必做）

1. 启动桌面端，打开「设置 -> 连接」。
2. 填写服务器地址，例如：
   - 本机：`ws://127.0.0.1:9090/astrbot/live2d`
   - 远程服务器：`ws://<服务器IP>:9090/astrbot/live2d`
3. 填写认证令牌（必填，需与适配器端 `auth_token` 一致）。
4. 点击「连接」。

连接成功后，令牌会保存在本地，下次启动无需重复输入。

## 3. 导入模型

1. 在主窗口点击「导入模型」。
2. 选择包含 `.model3.json` 或 `.model.json` 的模型目录。
3. 等待加载完成。

导入成功后，模型与位置会自动记忆。

## 4. 日常使用

### 4.1 文本对话

- 右键模型打开圆盘菜单，点击「对话」。
- 输入文字并发送，服务端回复会以气泡/动作/语音形式展示。

### 4.2 录音发送

- 在输入区按住麦克风按钮开始录音，松开后自动发送。
- 也可在设置中配置全局录音快捷键。

### 4.3 语音唤醒

- 在设置中开启「语音唤醒」后，命中关键词自动触发录音。
- 模型右键菜单提供「唤醒:开/关」快捷切换。
- 出于安全考虑，该功能每次重启默认关闭。

### 4.4 历史与统计

- 右键模型 ->「历史」可查看聊天记录、资源使用、统计图表。

## 5. 常见问题

### 5.1 提示“认证失败”或无法连接

- 检查桌面端令牌是否与适配器 `auth_token` 完全一致。
- 检查地址是否包含正确路径：`/astrbot/live2d`。
- 检查服务端端口是否开放（云服务器场景）。

### 5.2 连接后很快断开

- 常见原因是令牌错误或服务端策略拒绝。
- 先在 AstrBot 端执行 `/live2d.status` 与 `/live2d.config` 查看状态。

### 5.3 发送图片/语音失败

- 检查适配器资源服务是否启动（默认 `9091`）。
- 检查防火墙和云安全组是否允许资源端口访问。

## 6. 推荐阅读

- 适配器教程（含云服务器防火墙与安全建议）：
  `AstrBot/data/plugins/astrbot-live2d-adapter/docs/TUTORIAL.zh-CN.md`
- 桥接协议文档：
  `AstrBot/data/plugins/astrbot-live2d-adapter/docs/API.md`
